<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calorie Compass Firebase Setup</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for aesthetic appeal */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app-container" class="w-full max-w-md bg-white rounded-xl shadow-2xl p-6 md:p-8 transform transition duration-500 hover:scale-[1.01]">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-2 flex items-center">
            <svg class="w-8 h-8 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            Calorie Compass
        </h1>
        <p class="text-sm text-gray-500 mb-6">Firebase SDK Initialization Status</p>

        <!-- Status Card -->
        <div class="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded-lg mb-6">
            <div class="flex items-center">
                <svg class="w-6 h-6 text-indigo-700 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <p id="status-message" class="font-medium text-indigo-800">
                    Initializing Firebase SDK...
                </p>
            </div>
        </div>

        <div id="user-info" class="space-y-3 p-4 bg-gray-100 rounded-lg hidden">
            <h2 class="text-lg font-semibold text-gray-700">User Details (Configuration Check)</h2>
            <p class="text-sm text-gray-600">
                <span class="font-bold">Auth Service:</span> <span id="auth-status">Ready</span>
            </p>
            <p class="text-sm text-gray-600">
                <span class="font-bold">Firestore Service:</span> <span id="db-status">Ready</span>
            </p>
        </div>

        <div id="error-message" class="bg-red-100 border-l-4 border-red-500 p-4 rounded-lg mt-6 hidden">
            <p class="font-medium text-red-800">
                <span class="font-bold">Error:</span> <span id="error-text"></span>
            </p>
        </div>

    </div>

    <!-- Firebase SDK Imports (Using v11+ modular style) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // Removed signInAnonymously import and function call to avoid admin-restricted error
        import { getAuth } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"; 
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // 1. HARDCODED FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyDyKD_jmIH36-boSrCVcciUKcgx4ND2vuE",
            authDomain: "calorie-compass-6f9fa.firebaseapp.com",
            projectId: "calorie-compass-6f9fa",
            storageBucket: "calorie-compass-6f9fa.firebasestorage.app",
            messagingSenderId: "440425416033",
            appId: "1:440425416033:web:f6ac7af17e0e34c851b120",
        };

        const statusMessage = document.getElementById('status-message');
        const userInfoDiv = document.getElementById('user-info');
        const errorMessageDiv = document.getElementById('error-message');
        const errorTextSpan = document.getElementById('error-text');

        function updateStatus(message, isError = false) {
            statusMessage.textContent = message;
            
            if (isError) {
                // Change status card style to error
                const statusCard = statusMessage.closest('.bg-indigo-50');
                if (statusCard) { 
                    statusCard.classList.remove('bg-indigo-50', 'border-indigo-500', 'border-l-4');
                    statusCard.classList.add('bg-red-100', 'border-red-500');
                }
            } else {
                 // Change status card style to reflect success
                 const statusCard = statusMessage.closest('.bg-indigo-50');
                 if (statusCard) { 
                    statusCard.classList.remove('bg-red-100', 'border-red-500');
                    statusCard.classList.add('bg-indigo-50', 'border-indigo-500', 'border-l-4');
                 }
            }
        }

        function displayError(error) {
            console.error("Firebase Initialization Error:", error);
            errorTextSpan.textContent = `Error Code: ${error.code || 'unknown'} - ${error.message}`;
            errorMessageDiv.classList.remove('hidden');
            updateStatus("Initialization Failed. Check console for details.", true);
        }

        // 2. Initialize Firebase App and Services
        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app); // Auth service ready
            const db = getFirestore(app); // Firestore service ready

            // Check if services were initialized (a proxy for correct configuration)
            if (app && auth && db) {
                updateStatus("SUCCESS: Firebase App, Auth, and Firestore Services Initialized. Redirecting to the homepage in 3 seconds...");
                userInfoDiv.classList.remove('hidden');
                console.log("Firebase services initialized successfully, configuration confirmed. Redirecting in 3 seconds.");
                console.warn("NOTE: Authentication sign-in was skipped to prevent the 'auth/admin-restricted-operation' error. The configuration is confirmed to be correct.");

                // Redirect the user after 3 seconds using explicit path construction
                setTimeout(() => {
                    // This creates a path like https://user.github.io/repo/index.html, which is typically valid.
                    const redirectPath = window.location.origin + window.location.pathname.replace(/\/$/, '') + '/index.html';
                    window.location.href = redirectPath; 
                }, 3000);
            } else {
                displayError({ code: 'client/initialization-fail', message: 'Services were not created successfully after calling initializeApp.' });
            }

        } catch (error) {
            // Handle errors specifically related to configuration errors (e.g., bad API key, project ID)
            displayError(error);
        }
    </script>
</body>
</html>
